メモリ管理
==========

概要
---
TODO

物理メモリと仮想メモリ
---------------------
TODO

メモリマップ
-----------
TODO

メモリ割り当て
-------------
メモリ割り当てする際、二種類の方法がある。
状況に応じて使い分ける事

* カーネル仮想メモリ空間（カーネルのヒープ領域）の割り当て
* ページの割り当て

前者はmallocやnewによるメモリ確保である。仮想メモリ空間上で連続したメモリ領域を獲得する事ができる。（物理メモリでは不連続な可能性あり）もちろん、mallocやnewによって確保されたアドレスは仮想アドレスである。
後者は、PhysmemCtrl::Alloc()を呼び出す事によって実現できる。PhysmemCtrlクラスは物理メモリを「ページ単位で」管理するクラスで、ページ単位でのメモリ確保、開放しかできない。しかし、逆に物理ページと同じ大きさ（あるいはその整数倍）のメモリを確保する際はむしろこちらを用いた方が便利な事が多い。（ページ境界にアラインされたメモリが取得できるため）mallocやnewも最終的にはPhysmemCtrl::Alloc()を呼び出すので、無理にmallocやnewを使おうとしても二度手間になってしまう。
PhysmemCtrl::Alloc()で取得できるのは物理アドレスであるため、仮想アドレスを取得するためにはp2v()で変換する必要がある。

p2v/v2pとk2p
-----------
ストレートマップ領域の仮想メモリアドレスと物理メモリアドレスの相互変換にはv2p()とp2v()を用いる。これらの関数はアドレスにストレートマップ領域のオフセットを足し引きするだけなので非常に高速である。
しかし、v2p()はストレートマップされていない仮想メモリの物理メモリは取得できない。この場合はk2pを用いる。k2pはページ構造を探索し、仮想アドレスから物理アドレスを取得する。当然重いので、出来る限りを用いる事。
